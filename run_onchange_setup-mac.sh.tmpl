#!/bin/bash

{{ if eq .chezmoi.os "darwin" -}}
configure_dock () {
    defaults write com.apple.dock orientation left # ç”»é¢ä¸Šã®ä½ç½®
    defaults write com.apple.dock tilesize -int 40 # ã‚µã‚¤ã‚º
    defaults write com.apple.dock magnification -bool true # æ‹¡å¤§ ON/OFF
    defaults write com.apple.dock largesize -int 60 # æ‹¡å¤§ã‚µã‚¤ã‚º
    defaults write com.apple.dock autohide -bool true # Dock ã‚’è‡ªå‹•çš„ã«è¡¨ç¤º/éè¡¨ç¤º
    defaults write com.apple.dock show-process-indicators -bool false # èµ·å‹•æ¸ˆã¿ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ã‚’è¡¨ç¤º
    defaults write com.apple.dock show-recents -bool false # æœ€è¿‘ä½¿ã£ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ Dock ã«è¡¨ç¤º
    defaults write com.apple.dock static-only -boolean true # èµ·å‹•æ¸ˆã¿ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã¿ Dock ã«è¡¨ç¤º
    defaults write com.apple.dock minimize-to-application -bool false # ã‚¦ã‚¤ãƒ³ãƒ‰ã‚¦ã‚’ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ã‚³ãƒ³ã«ã—ã¾ã†ã‹ã€åˆ¥ã®ã‚¢ã‚¤ã‚³ãƒ³ã¨ã—ã¦ã—ã¾ã†ã‹
    defaults write com.apple.dock mineffect -string "genie" # ã‚¦ã‚¤ãƒ³ãƒ‰ã‚¦ã‚’ã—ã¾ã†ã¨ãã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
}

configure_keyboard () {
    defaults write -g InitialKeyRepeat -int 15 # ãƒªãƒ”ãƒ¼ãƒˆå…¥åŠ›èªè­˜ã¾ã§ã®æ™‚é–“
    defaults write -g KeyRepeat -int 2 # ã‚­ãƒ¼ã®ãƒªãƒ”ãƒ¼ãƒˆé€Ÿåº¦
    defaults write -g NSAutomaticCapitalizationEnabled -bool false # æ–‡é ­ã‚’è‡ªå‹•çš„ã«å¤§æ–‡å­—ã«ã™ã‚‹
    defaults write -g NSAutomaticPeriodSubstitutionEnabled -bool false # ã‚¹ãƒšãƒ¼ã‚¹ãƒãƒ¼ã‚’2å›æŠ¼ã—ã¦ãƒ”ãƒªã‚ªãƒ‰ã‚’å…¥åŠ›
    defaults write -g NSAutomaticSpellingCorrectionEnabled -bool false # è‹±å­—å…¥åŠ›ä¸­ã«ã‚¹ãƒšãƒ«ã‚’è‡ªå‹•å¤‰æ›
}

configure_trackpad () {
    defaults write -g com.apple.trackpad.scaling -float 1.5 # Tracking speed
    defaults write com.apple.AppleMultitouchTrackpad Clicking -bool true # Tap to click
    defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad Clicking -bool true # Tap to click
}

configure_menubar () {
    defaults write com.apple.controlcenter.plist "NSStatusItem Visible Bluetooth" -bool true # Bluetooth ã‚’ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã«è¡¨ç¤º
    defaults write com.apple.menuextra.clock.plist ShowDate -bool true # æ—¥ä»˜ã‚’å¸¸ã«è¡¨ç¤º
}

configure_finder () {
    defaults write com.apple.finder AppleShowAllFiles TRUE # éš ã—ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¡¨ç¤º
}

echo "ğŸš€ Setup user defaults..."
configure_dock
configure_keyboard
configure_trackpad
configure_menubar

for app in "Dock" \
	"Finder" \
	"SystemUIServer"; do
	killall "${app}" &>/dev/null
done

# Install safe-chain for package security
echo "ğŸ”’ Installing Aikido Safe Chain..."
if command -v npm &>/dev/null; then
    npm install -g @aikidosec/safe-chain
    safe-chain setup
    echo "âœ… Aikido Safe Chain installed successfully"
else
    echo "âš ï¸  npm not found. Skipping safe-chain installation."
fi
{{ end -}}
